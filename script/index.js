!function(t){"use strict";t.module("app.audio",[]).controller("AudioController",["$scope","$window","MainService",function(t,i,e){function s(t){if(t.constructor==Array){for(var i=[],e=0;e<t.length;e++)i.push({id:+new Date+e,songId:t[e].songid,name:t[e].songname,src:t[e].url||n(t[e].songid)});return i}if(t.constructor==Object)return{id:+new Date,songId:t.songid,name:t.songname,src:t.url||n(t.songid)}}function n(t){return"http://ws.stream.qqmusic.qq.com/"+t+".m4a?fromtag=46"}i.onresize=function(){t.clientWidth=i.document.documentElement.clientWidth||i.innerWidth||i.document.body.clientWidth};var a=new Player({container:"playerContainer",audio:"myPlayer"}),o=i.localStorage;t.playList=o.myPlayList?JSON.parse(o.myPlayList):[],o.myPlayList&&(a.list=t.playList,a.upDateList()),t.addToList=function(i){var e=s(i);t.playList=t.playList.concat(e),a.list=t.playList,a.save(),a.upDateList()},t.playItem=function(e){a.index=0==a.list.length?0:a.index+1,t.playList=t.playList.splice(0,a.index).concat(s(e)).concat(t.playList),a.list=t.playList,a.save(),a.playIndex(a.list[a.index].id),i.hoverAndLeave()},t.removeList=function(){t.playList=[],o.removeItem("myPlayList"),a.list=[],a.save(),a.index=0,a.upDateList()}}])}(angular),function(t){"use strict";t.module("app.config",[]).constant("params",{showapi_appid:"33166",showapi_sign:"346362089aad4e5680f74ffdaa7e0c2f",address:"https://route.showapi.com/213-4?",lycAddress:"https://route.showapi.com/213-2?",searchAddress:"https://c.y.qq.com/soso/fcgi-bin/client_search_cp?",num:20,detailUrl:"https://c.y.qq.com/v8/fcg-bin/fcg_v8_album_info_cp.fcg?"})}(angular),function(t){"use strict";t.module("app.details",[]).controller("DetailsController",["$scope","$stateParams","MainService","params",function(t,i,e,s){function n(t){return t.replace(/(^\s*)|(\s*$)/g,"")}function a(t){""==t&&a(t);for(var i=n(t).split("    "),e=[],s=0;s<i.length;s++)""!=n(i[s])&&e.push(n(i[s]));return e}function o(i){t.getImg=e.getBImg,t.getSongname=function(){var e=i.list;for(var s in e)if(t.songid==e[s].songid)return e[s].songname},t.getSinger=function(){var e="",s=i.list;for(var n in s)if(t.songid==s[n].songid)return e=s[n].singer[0].name},t.getItem=function(){var e=i.list;for(var s in e)if(t.songid==e[s].songid)return e[s]}}t.detail=[],t.lyc=[],t.songid=i.songid,t.albummid=i.albummid;var l=e.getDetail();l.then(function(i){t.detail=i.data,o(t.detail)},function(t){console.log("获取失败")});var r=e.getLyc(t.songid);r.then(function(i){t.lyc=a(i.data.showapi_res_body.lyric_txt)},function(t){console.log("获取失败")})}])}(angular),function(t){var i=t.module("musicList",["app.route","app.config"]);i.config(["$locationProvider",function(t){t.hashPrefix("")}]),i.controller("HomeController",["$scope","$state","$q","MainService",function(t,i,e,s){t.keyword="",t.show_flag=!1,t.search=function(){""!=t.keyword.replace(/(^\s*)|(\s*$)/g,"")&&i.go("music.tabs.search",{page:1,keyword:t.keyword})},t.showOrHide=function(){t.show_flag=!t.show_flag},t.listArr=[],t.list_27=[],t.list_26=[],t.list_4=[],t.loadData=function(){console.log("加载数据...")},e.all([s.getSong(27),s.getSong(26),s.getSong(4)]).then(function(i){var e=!!i[0].data.showapi_res_body.pagebean.songlist&&!!i[1].data.showapi_res_body.pagebean.songlist&&!!i[2].data.showapi_res_body.pagebean.songlist;e&&(t.list_27=i[0].data.showapi_res_body.pagebean.songlist.slice(0,4),t.list_26=i[1].data.showapi_res_body.pagebean.songlist.slice(0,4),t.list_4=i[2].data.showapi_res_body.pagebean.songlist.slice(0,4),t.listArr=[],t.listArr.push(t.list_27),t.listArr.push(t.list_26),t.listArr.push(t.list_4))},function(){console.log("获取失败")})}]),i.directive("lunbo",function(){return{restrict:"AE",controller:"HomeController",templateUrl:"lunbo.html",link:function(t,i,e){function s(){i.find("li").addClass("ishide"),i.find("li").removeClass("active"),i.find("i").removeClass("active"),a++,a%=3,i.find("li").eq(a).addClass("active"),i.find("i").eq(a).addClass("active")}var n,a=0;n=setInterval(s,3e3),i.find("ul").bind("mouseenter",function(){clearInterval(n)}),i.find("ul").bind("mouseleave",function(){clearInterval(n),n=setInterval(s,3e3)}),i.find("a").eq(0).bind("click",function(){a-=2,s()}),i.find("a").eq(1).bind("click",function(){s()}),i.find("i").bind("click",function(){var t=parseInt(this.innerText);i.find("li").eq(0).addClass("ishide"),i.find("i").removeClass("active"),i.find("i").eq(t).addClass("active"),i.find("li").removeClass("active"),i.find("li").eq(t).addClass("active")})}}})}(angular);var Player=function(t){this.init(t)};Player.prototype={init:function(t){this.container=t.container.constructor===String?document.getElementById(t.container):t.container,this.audio=t.audio.constructor===String?document.getElementById(t.audio):t.audio,this.storage=window.localStorage,this.list=this.storage.myPlayList?JSON.parse(this.storage.myPlayList):[],this.index=0,this.time_pause=0,this.b=!0,this.bindDom(),this.next=document.getElementById("play_next"),this.prev=document.getElementById("play_prev"),this.playPause=document.getElementById("playPause"),this.time_current=document.getElementById("time_current"),this.time_progress_bar=document.getElementById("time_progress_bar"),this.time_progress=document.getElementById("time_progress"),this.time_total=document.getElementById("time_total"),this.audio_title=document.getElementById("audio_title"),this.btn_listbox=document.getElementById("btn_listbox"),this.audio_list=document.getElementById("audio_list"),this.volume_adjust=document.getElementById("volume_adjust"),this.icon_volume=document.getElementById("icon_volume"),this.vol_bar=document.getElementById("vol_bar"),this.vol_mask=document.getElementById("vol_mask"),this.bindEvent(),Object.defineProperty(this,"volume",{get:function(){return this.vol_bar.style.height},set:function(t){t>=0&&t<=1&&(this.vol_bar.style.height=100*t+"%")}}),Object.defineProperty(this,"progress",{get:function(){return this.time_progress_bar.style.width},set:function(t){t>=0&&t<=1&&(this.time_progress_bar.style.width=100*t+"%")}})},doms:function(){var t="";return t+=' <div id="audioPlayer">',t+='    <div class="btns">',t+='        <button id="play_prev" class="prev icon-prev"></button>',t+='        <button id="playPause" class="playPause icon-play"></button>',t+='        <button id="play_next" class="next icon-next"></button>',t+="    </div>",t+='    <div class="content">',t+='        <span id="time_current">00:00</span>',t+='        <div class="bar_container">',t+='            <span id="audio_title" title="歌曲名称">歌曲名称</span>',t+='            <div id="time_progress">',t+='                <div id="time_progress_bar" style="width: 0;">',t+="                </div>",t+="            </div>",t+="        </div>",t+='        <span id="time_total">00:00</span>',t+="    </div>",t+='    <div class="listbox">',t+='        <button id="btn_listbox" title="列表"><span class="icon-folder"></span></button>',t+='        <div id="audio_list">',t+="            <ol>",t+="            </ol>",t+='            <div class="scroll">',t+='                 <div class= "bar">',t+="                 </div>",t+="            </div>",t+="        </div>",t+="    </div>",t+='    <div class="volume">',t+='        <button id="volume_adjust">',t+='            <span id="icon_volume" class="icon-volume-up"></span>',t+="        </button>",t+='        <div class="volume_progress">',t+='            <div  class="progress_col">',t+='                 <div id="vol_mask"></div>',t+='                <div id="vol_bar" class="progress_bar_col" style="height:50%"></div>',t+="            </div>",t+="        </div>",t+="    </div>",t+=" </div>"},save:function(){this.storage.myPlayList=JSON.stringify(this.list)},trigger:function(){this.time_pause=0!==this.audio.currentTime?this.audio.currentTime:this.time_pause,this.playAndPause(),this.updateTime()},bindDom:function(){this.container.innerHTML=this.doms()},bindEvent:function(){var t=this;this.on(this.playPause,"click",function(){t.trigger()}),this.on(this.next,"click",function(){t.playNext()}),this.on(this.prev,"click",function(){t.playPrev()}),this.on(this.btn_listbox,"click",function(){t.listShowOrHide(),"icon-folder"==this.children[0].className?this.children[0].className="icon-folder-open":this.children[0].className="icon-folder"}),this.on(this.icon_volume,"click",function(){t.volumeOffOrUp()}),this.on(this.time_progress,"click",function(i){t.adjustProgress(i)}),this.on(this.vol_mask,"click",function(i){t.adjustVol(i)}),this.on(this.audio_list.children[0],"click",function(i){var i=i||window.event,e=i.target||i.srcElement;"A"==e.nodeName.toUpperCase()?(t.playIndex(e.parentNode.id),t.barMove(e.parentNode.id)):"SPAN"==e.nodeName.toUpperCase()&&(t.delList(e.parentNode.id),t.save())})},on:function(t,i,e){t.addEventListener?t.addEventListener(i,e,!1):t.attachEvent&&t.attachEvent("on"+i,e)},getItem:function(){return this.list.length?this.list[this.index]:void 0},loadNewSrc:function(){this.time_pause=0,this.b=!0},playAndPause:function(t){var t=t|this.audio.paused,i=this.getItem();this.list.length&&(this.b&&(this.audio.src=i.src,this.audio_title.innerHTML=i.name,this.audio_title.title=i.name,this.upDateList(),this.b=!1),t?(this.audio.currentTime=this.time_pause,this.playPause.className="icon-pause",this.audio.play()):(this.playPause.className="icon-play",this.audio.pause()))},playNext:function(){this.loadNewSrc(),this.index++,this.index==this.list.length&&(this.index=0),this.playAndPause(!0),this.updateTime()},playPrev:function(){this.loadNewSrc(),this.index--,this.index==-1&&(this.index=this.list.length-1),this.playAndPause(!0),this.updateTime()},playIndex:function(t){for(var i=0;i<this.list.length;i++)if(this.list[i].id==t)return this.loadNewSrc(),this.index=i,this.playAndPause(!0),void this.updateTime()},listShowOrHide:function(){"show"===this.audio_list.className?this.audio_list.className="":this.audio_list.className="show"},volumeOffOrUp:function(){this.audio.muted?(this.audio.muted=!1,this.vol_bar.style.width="100%",this.icon_volume.className="icon-volume-up"):(this.audio.muted=!0,this.vol_bar.style.width=0,this.icon_volume.className="icon-volume-off")},timeTrans:function(t){var i,e,s;return e=parseInt(t/60),s=parseInt(t%60),s=s>9?s:"0"+s,e=e>9?e:"0"+e,i=e+":"+s},updateTime:function(){var t,i=this,e=i.audio;i.audio.src&&(t=setInterval(function(){i.audio.ended?(i.loadNewSrc(),clearInterval(t),i.playNext(),i.updateTime()):i.audio.paused?clearInterval(t):(i.time_current.innerText=i.timeTrans(e.currentTime)||"00:00",i.time_total.innerText=i.timeTrans(e.duration)||"00:00",i.progress=e.currentTime/e.duration)},200))},adjustProgress:function(t){var i,e,s,n,a;n=this.audio,0!=n.readyState&&(i=t.offsetX,e=this.time_progress.offsetWidth,s=i/e,a=parseInt(n.duration*s),this.progress=s,n.fateSeek?(console.log(11),n.fateSeek(a)):a<n.seekable.end(0)&&a>n.seekable.start(0)?n.currentTime=a:n.currentTime=n.buffered.end(n.buffered.length-1))},adjustVol:function(t){var i,e,s,n,s;n=this.audio,i=t.offsetY,e=this.vol_mask.offsetHeight,s=(e-i)/e,this.volume=s,n.volume=s},upDateList:function(){var t=this.audio_list.children[0],i="";if(!this.list.length)return void(t.innerHTML="");for(var e=0;e<this.list.length;e++)e==this.index?(i+='<li id="'+this.list[e].id+'" class="active" >',i+='<a href="javascript:;" title="'+this.list[e].name+'">'+this.list[e].name+"</a><span>×</span></li>"):(i+='<li id="'+this.list[e].id+'" >',i+='<a href="javascript:;" title="'+this.list[e].name+'">'+this.list[e].name+"</a><span>×</span></li>");t.innerHTML=i,this.barMove(this.list[this.index].id)},delList:function(t){if(1==this.list.length)this.audio.pause(),this.playPause.className="icon-play",this.audio.currentTime=0,this.time_current.innerText="00:00",this.progress=0,this.time_total.innerText="00:00",this.audio_title.innerText="歌曲名称",this.list=[],this.upDateList();else{t==this.list[this.index].id&&this.playNext();for(var i=[],e=0,s=0;s<this.list.length;s++)t==this.list[s].id?e=s<this.list.length-1?s:0:i.push(this.list[s]);this.list=i,this.index=e,this.upDateList()}},barMove:function(t){if(""!=this.audio_list.children[0].innerHTML.replace(/(^\s*)|(\s*$)/g,"")){var i=document.getElementById(t),e=i.offsetTop,s=i.offsetHeight,n=this.audio_list,a=n.offsetHeight,o=n.scrollHeight;e>.5*a?n.scrollTop=3*s+e-a>o-a?o-a:3*s+e-a:n.scrollTop=0}}},function(t){t.module("app.route",["ui.router","app.songList","app.searchList","app.details","app.audio"]).config(["$stateProvider","$urlRouterProvider",function(t,i){t.state("music",{url:"/music",abstract:!0,templateUrl:"templates/player.html",controller:"AudioController"}).state("music.home",{url:"/home",controller:"HomeController",templateUrl:"templates/home.html"}).state("music.details",{url:"/details/{songid}/{albummid}",controller:"DetailsController",templateUrl:"templates/details.html"}).state("music.tabs",{url:"/tabs",templateUrl:"templates/tabs.html"}).state("music.tabs.list",{url:"/list/:id",controller:"SongListController",templateUrl:"templates/songList.html"}).state("music.tabs.search",{url:"/search/{page:int}/:keyword",controller:"SearchListController",templateUrl:"templates/searchList.html"}),i.otherwise("/music/home")}])}(angular),function(t){"use strict";t.module("app.searchList",["app.service"]).controller("SearchListController",["$scope","$stateParams","MainService","params",function(t,i,e,s){t.search=[],t.keyword="",t.num=s.num,t.totalnum=0,t.totalPage=0,t.currentPage=0,t.searchUrl=s.searchAddress;var n=e.getSearch();n.then(function(i){console.log(i),t.search=i.data.song.list,t.keyword=i.data.keyword,t.totalnum=i.data.song.totalnum,t.currentPage=i.data.song.curpage,t.totalPage=Math.ceil(t.totalnum/t.num)},function(){console.log("获取失败")}),t.getImg=e.getImg}])}(angular),function(t){t.module("app.service",[]).service("MainService",["$sce","$http","$q","$stateParams","$window","$document","params",function(t,i,e,s,n,a,o){this.getSong=function(s){var n=e.defer(),a=o.address+"showapi_appid="+o.showapi_appid+"&showapi_sign="+o.showapi_sign+"&topid="+s;return a=t.trustAsResourceUrl(a),i.jsonp(a,{jsonpCallbackParam:"jsonpcallback"}).then(function(t){n.resolve(t)},function(t){console.log(222),n.reject(t)}),n.promise},this.getLyc=function(s){var n=e.defer(),a=o.lycAddress+"showapi_appid="+o.showapi_appid+"&showapi_sign="+o.showapi_sign+"&musicid="+s;return a=t.trustAsResourceUrl(a),i.jsonp(a,{jsonpCallbackParam:"jsonpcallback"}).then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise},this.getSearch=function(){var i=e.defer(),l=o.searchAddress+"n="+o.num+"&p="+s.page+"&w="+s.keyword;l=t.trustAsResourceUrl(l);var r="jsonp"+ +new Date,d=a[0].createElement("script");return d.src=l+"&jsonpCallback="+r,n[r]=function(t){i.resolve(t),a[0].body.removeChild(d)},a[0].body.appendChild(d),i.promise},this.getDetail=function(){var i=e.defer(),l=o.detailUrl+"albummid="+s.albummid;l=t.trustAsResourceUrl(l);var r="jsonp"+ +new Date,d=a[0].createElement("script");return d.src=l+"&jsonpCallback="+r,n[r]=function(t){i.resolve(t),a[0].body.removeChild(d)},a[0].body.appendChild(d),i.promise},this.getImg=function(t){var i=t.length,e=t.charAt(i-1),s=t.charAt(i-2);return"http://i.gtimg.cn/music/photo/mid_album_90/"+s+"/"+e+"/"+t+".jpg"},this.getBImg=function(t){var i=t.length,e=t.charAt(i-1),s=t.charAt(i-2);return"http://i.gtimg.cn/music/photo/mid_album_300/"+s+"/"+e+"/"+t+".jpg"}}])}(angular),function(t){t.module("app.songList",["app.service"]).controller("SongListController",["$scope","$http","$stateParams","MainService",function(t,i,e,s){t.list=[],t.topid=e.id,t.array=[{id:27,title:"新歌"},{id:26,title:"热歌"},{id:4,title:"流行"},{id:5,title:"内地"},{id:6,title:"港台"},{id:3,title:"欧美"},{id:17,title:"日本"},{id:16,title:"韩国"},{id:36,title:"k歌金曲"},{id:28,title:"网络歌曲"}],t.title="",t.title=function(){for(var i in t.array)if(t.topid==t.array[i].id)return t.array[i].title}();var n=s.getSong(t.topid);n.then(function(i){t.list=i.data.showapi_res_body.pagebean.songlist},function(t){console.log("请求失败")})}])}(angular);